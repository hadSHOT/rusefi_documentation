-- scriptname B6-2024-july.txt

-- include can_ids.lua
-- endinclude

-- include utils.lua
-- endinclude

setTickRate(100)

canRxAdd(ECU_BUS, MOTOR_1, silentlyRelayFromECU)
canRxAdd(ECU_BUS, MOTOR_BRE, silentlyRelayFromECU)
canRxAdd(ECU_BUS, MOTOR_2_648, silentlyRelayFromECU)
canRxAdd(ECU_BUS, MOTOR_3, silentlyRelayFromECU)
canRxAdd(ECU_BUS, MOTOR_5, silentlyRelayFromECU)
canRxAdd(ECU_BUS, MOTOR_6, silentlyRelayFromECU)
canRxAdd(ECU_BUS, MOTOR_7, silentlyRelayFromECU)
canRxAdd(ECU_BUS, ACC_GRA, silentlyRelayFromECU)
canRxAdd(ECU_BUS, MOTOR_INFO, silentlyRelayFromECU)

canRxAdd(ECU_BUS, Gate_Komf_1, silentlyRelayFromECU)
canRxAdd(ECU_BUS, Kombi_1, silentlyRelayFromECU)
canRxAdd(ECU_BUS, Kombi_3, silentlyRelayFromECU)
canRxAdd(ECU_BUS, Soll_Verbauliste_neu, silentlyRelayFromECU)
canRxAdd(ECU_BUS, GRA_Neu, silentlyRelayFromECU)
canRxAdd(ECU_BUS, Systeminfo_1, silentlyRelayFromECU)

canRxAdd(ECU_BUS, VWTP_OUT, silentlyRelayFromECU)

canRxAdd(ECU_BUS, Bremse_1, silentlyRelayFromECU)
canRxAdd(ECU_BUS, Bremse_2, silentlyRelayFromECU)
canRxAdd(ECU_BUS, Bremse_3, silentlyRelayFromECU)
canRxAdd(ECU_BUS, Bremse_4, silentlyRelayFromECU)
canRxAdd(ECU_BUS, Bremse_5, silentlyRelayFromECU)
canRxAdd(ECU_BUS, Bremse_6, silentlyRelayFromECU)
canRxAdd(ECU_BUS, BRAKE_8_428, silentlyRelayFromECU)

canRxAdd(ECU_BUS, Diagnose_1, silentlyRelayFromECU)

canRxAdd(ECU_BUS, Lenkwinkel_1, drop)
canRxAdd(ECU_BUS, Lenkhilfe_3, drop)
canRxAdd(ECU_BUS, Lenkhilfe_2, drop)
canRxAdd(ECU_BUS, Klima_1, drop)
canRxAdd(ECU_BUS, BSG_Last, drop)
canRxAdd(ECU_BUS, AIRBAG, drop)

canRxAdd(ECU_BUS, Lenkhilfe_1, drop)
canRxAdd(ECU_BUS, EPB_1, drop)

canRxAdd(ECU_BUS, 1394, drop)
canRxAdd(ECU_BUS, 1056, drop)

canRxAdd(ECU_BUS, 1478, drop)
--canRxAdd(ECU_BUS, 1490, drop)
--canRxAdd(ECU_BUS, 1888, drop)
--canRxAdd(ECU_BUS, 1360, drop)


function verboseRelayFromECU(bus, id, dlc, data)
    onEcuTimer : reset ()
--    print("Relaying to TCU " .. id)
	totalEcuMessages = totalEcuMessages + 1
	txCan(TCU_BUS, id, 0, data)
end

canRxAddMask(ECU_BUS, 0, 0, verboseRelayFromECU)
canRxAddMask(TCU_BUS, 0, 0, silentlyRelayFromTCU)

everySecondTimer = Timer.new()

function onTick()
	if everySecondTimer : getElapsedSeconds() > 1 then
		everySecondTimer : reset()
		print("Total from ECU " ..totalEcuMessages .. " totalTcuMessages " .. totalTcuMessages)
	end
end

